<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Blackjack Mejorado</title>
  <style>
    body {
      background: #222;
      color: white;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      min-height: 100vh;
      margin: 0;
    }
    h1 {
      margin-bottom: 20px;
    }
    #blackjack {
      background: #333;
      padding: 20px;
      border-radius: 10px;
      width: 320px;
      box-shadow: 0 0 15px #ff3333;
    }
    .mano {
      display: flex;
      justify-content: center;
      margin: 10px 0;
    }
    .carta {
      background: white;
      color: black;
      border-radius: 5px;
      width: 50px;
      height: 70px;
      margin: 0 5px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-weight: bold;
      font-size: 20px;
      box-shadow: 0 0 5px #000;
      user-select: none;
    }
    #botones button {
      margin: 5px;
      padding: 10px 15px;
      font-size: 16px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      background: #ff3333;
      color: white;
      transition: background 0.3s;
    }
    #botones button:disabled {
      background: #800000;
      cursor: not-allowed;
    }
    #mensaje {
      margin-top: 15px;
      font-size: 18px;
      height: 24px;
      min-height: 24px;
      min-width: 300px;
      text-align: center;
    }
  </style>
</head>
<body>
  <h1>Blackjack Mejorado</h1>
  <div id="blackjack">
    <div><strong>Mano Jugador:</strong></div>
    <div id="manoJugador" class="mano"></div>
    <div><strong>Mano Dealer:</strong></div>
    <div id="manoDealer" class="mano"></div>

    <div id="botones">
      <button id="btnPedir">Pedir Carta</button>
      <button id="btnPlantarse">Plantarse</button>
      <button id="btnDoblar">Doblar</button>
      <button id="btnDividir">Dividir</button>
      <button id="btnReiniciar" disabled>Reiniciar</button>
    </div>

    <div id="mensaje"></div>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

  <script>
    // Config Firebase (tu configuraciÃ³n real)
    const firebaseConfig = {
      apiKey: "AIzaSyBDWxn28oXn04--DMwkzqMq00g_W-OYJ3g",
      authDomain: "lunabet-73609.firebaseapp.com",
      databaseURL: "https://lunabet-73609-default-rtdb.firebaseio.com",
      projectId: "lunabet-73609",
      storageBucket: "lunabet-73609.firebasestorage.app",
      messagingSenderId: "45582135337",
      appId: "1:45582135337:web:3cb9190e37827d9cc72c38",
      measurementId: "G-0XC4PX3HK9"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    // Verificar sesiÃ³n
    auth.onAuthStateChanged(user => {
      if (!user) {
        window.location.href = '../login.html'; // Redirige si no estÃ¡ logueado
      }
    });

    // Juego Blackjack

    // Baraja con valores y sÃ­mbolos
    const palos = ['â™ ', 'â™¥', 'â™¦', 'â™£'];
    const valores = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];

    let baraja = [];
    let manoJugador = [];
    let manoDealer = [];
    let saldo = 1000;
    let apuesta = 100;
    let puedeDividir = false;
    let juegoTerminado = false;
    let doblarHecho = false;

    // Elementos DOM
    const manoJugadorDiv = document.getElementById('manoJugador');
    const manoDealerDiv = document.getElementById('manoDealer');
    const mensajeDiv = document.getElementById('mensaje');

    const btnPedir = document.getElementById('btnPedir');
    const btnPlantarse = document.getElementById('btnPlantarse');
    const btnDoblar = document.getElementById('btnDoblar');
    const btnDividir = document.getElementById('btnDividir');
    const btnReiniciar = document.getElementById('btnReiniciar');

    function crearBaraja() {
      baraja = [];
      for (const palo of palos) {
        for (const valor of valores) {
          baraja.push({palo, valor});
        }
      }
      // Barajar
      for (let i = baraja.length -1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i+1));
        [baraja[i], baraja[j]] = [baraja[j], baraja[i]];
      }
    }

    function valorCarta(carta) {
      if (carta.valor === 'A') return 11;
      if (['J','Q','K'].includes(carta.valor)) return 10;
      return parseInt(carta.valor);
    }

    function valorMano(mano) {
      let total = 0;
      let ases = 0;
      for (const carta of mano) {
        total += valorCarta(carta);
        if (carta.valor === 'A') ases++;
      }
      while (total > 21 && ases > 0) {
        total -= 10;
        ases--;
      }
      return total;
    }

    function mostrarMano(div, mano, ocultarDealer = false) {
      div.innerHTML = '';
      mano.forEach((carta, i) => {
        const cartaDiv = document.createElement('div');
        cartaDiv.className = 'carta';
        if (ocultarDealer && i === 0) {
          cartaDiv.textContent = 'ðŸ‚ '; // Carta tapada
        } else {
          cartaDiv.textContent = carta.valor + carta.palo;
        }
        div.appendChild(cartaDiv);
      });
    }

    function iniciarJuego() {
      crearBaraja();
      manoJugador = [];
      manoDealer = [];
      juegoTerminado = false;
      doblarHecho = false;
      mensajeDiv.textContent = '';
      btnReiniciar.disabled = true;
      btnPedir.disabled = false;
      btnPlantarse.disabled = false;
      btnDoblar.disabled = false;
      btnDividir.disabled = false;

      // Dar dos cartas jugador y dealer
      manoJugador.push(baraja.pop());
      manoDealer.push(baraja.pop());
      manoJugador.push(baraja.pop());
      manoDealer.push(baraja.pop());

      mostrarMano(manoJugadorDiv, manoJugador);
      mostrarMano(manoDealerDiv, manoDealer, true);

      puedeDividir = (manoJugador.length === 2 && manoJugador[0].valor === manoJugador[1].valor);

      // Verificar blackjack jugador
      if (valorMano(manoJugador) === 21) {
        juegoTerminado = true;
        mensajeDiv.textContent = 'Â¡Blackjack! Ganas 1.5x la apuesta.';
        finalizarJuego();
      }
    }

    function pedirCarta() {
      if (juegoTerminado) return;
      manoJugador.push(baraja.pop());
      mostrarMano(manoJugadorDiv, manoJugador);

      if (valorMano(manoJugador) > 21) {
        mensajeDiv.textContent = 'Te pasaste, perdiste.';
        juegoTerminado = true;
        finalizarJuego();
      }
    }

    function plantarse() {
      if (juegoTerminado) return;
      btnPedir.disabled = true;
      btnPlantarse.disabled = true;
      btnDoblar.disabled = true;
      btnDividir.disabled = true;

      // Mostrar cartas dealer y juega dealer
      mostrarMano(manoDealerDiv, manoDealer, false);
      while (valorMano(manoDealer) < 17) {
        manoDealer.push(baraja.pop());
        mostrarMano(manoDealerDiv, manoDealer, false);
      }

      const valJugador = valorMano(manoJugador);
      const valDealer = valorMano(manoDealer);

      if (valDealer > 21 || valJugador > valDealer) {
        mensajeDiv.textContent = 'Ganaste!';
      } else if (valJugador < valDealer) {
        mensajeDiv.textContent = 'Perdiste.';
      } else {
        mensajeDiv.textContent = 'Empate.';
      }
      juegoTerminado = true;
      finalizarJuego();
    }

    function doblar() {
      if (juegoTerminado || doblarHecho) return;
      doblarHecho = true;
      apuesta *= 2;
      pedirCarta();
      if (!juegoTerminado) plantarse();
      btnDoblar.disabled = true;
    }

    function dividir() {
      if (juegoTerminado || !puedeDividir) return;

      // Solo una mano simple implementada (no mano dividida real)
      mensajeDiv.textContent = 'Funcionalidad de dividir no implementada completamente aÃºn.';
      btnDividir.disabled = true;
    }

    function finalizarJuego() {
      btnReiniciar.disabled = false;
      btnPedir.disabled = true;
      btnPlantarse.disabled = true;
      btnDoblar.disabled = true;
      btnDividir.disabled = true;
    }

    btnPedir.addEventListener('click', pedirCarta);
    btnPlantarse.addEventListener('click', plantarse);
    btnDoblar.addEventListener('click', doblar);
    btnDividir.addEventListener('click', dividir);
    btnReiniciar.addEventListener('click', () => {
      apuesta = 100;
      iniciarJuego();
    });

    iniciarJuego();
  </script>
</body>
</html>
